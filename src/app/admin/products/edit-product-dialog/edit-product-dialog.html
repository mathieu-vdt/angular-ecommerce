<p-dialog
  [header]="(formData.id ? 'Edit Product' : 'Create Product')"
  [(visible)]="visible"
  [modal]="true"
  [closable]="false"
  styleClass="w-96">

  <!-- Toast global -->
  <p-toast />

  <div class="p-fluid space-y-4">
    <!-- Name -->
    <div class="field">
      <label for="name" class="block text-sm font-semibold text-gray-800">Name</label>
      <input id="name" type="text" pInputText [(ngModel)]="formData.name"
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
    </div>

    <!-- Description -->
    <div class="field">
      <label for="description" class="block text-sm font-semibold text-gray-800">Description</label>
      <textarea id="description" pInputTextarea [(ngModel)]="formData.description"
                rows="3"
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
    </div>

    <!-- Price -->
    <div class="field">
      <label for="price" class="block text-sm font-semibold text-gray-800">Price</label>
      <input id="price" type="number" pInputText [(ngModel)]="formData.price"
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"/>
    </div>

    <!-- Stock -->
    <div class="field">
      <label for="stock" class="block text-sm font-semibold text-gray-800">Stock</label>
      <input id="stock" type="number" pInputText [(ngModel)]="formData.stock"
             class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-2"/>
    </div>

    <!-- Image Upload (pas d'upload auto) -->
    <p-fileUpload
      name="image"
      mode="basic"
      chooseLabel="Choisir une image"
      [auto]="false"
      [customUpload]="true"
      [showUploadButton]="false"
      [showCancelButton]="false"
      [maxFileSize]="5_000_000"
      accept="image/*"
      (onSelect)="onFileSelect($event)"
      (onClear)="onClearFile()">
    </p-fileUpload>

    <!-- Aperçu image : affiche soit l'image existante, soit celle sélectionnée localement -->
    <div class="mt-3" *ngIf="imagePreviewUrl">
      <p>Prévisualisation :</p>

      <!-- p-image permet le zoom/preview en plein écran -->
      <p-image 
        [src]="imagePreviewUrl" 
        [alt]="formData?.name || 'preview'" 
        [preview]="true" 
        imageStyleClass="w-full max-h-64 object-contain rounded border">
      </p-image>

      <p class="text-sm text-muted mt-1" *ngIf="selectedFile">
        {{ selectedFile?.name }} ({{ selectedFile?.size | number }} o)
      </p>
    </div>

    <!-- Category -->
    <div class="field">
      <label for="category" class="block text-sm font-semibold text-gray-800">Category</label>
      <p-select id="category"
                [(ngModel)]="formData.idCategory"
                [options]="categories"
                optionLabel="name"
                optionValue="id"
                placeholder="Select Category"
                appendTo="body"
                class="w-full border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
      </p-select>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2">
      <p-button label="Cancel" severity="secondary" (click)="onCancel()" [disabled]="isSaving"/>
      <p-button label="Save" (click)="onSave()" [loading]="isSaving" [disabled]="isSaving"/>
    </div>
  </ng-template>
</p-dialog>
